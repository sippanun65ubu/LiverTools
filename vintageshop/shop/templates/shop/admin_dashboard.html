<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>

    <!-- jQuery (required by Select2) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Select2 CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        /* ปรับปรุง UI */
        .select2-container {
            width: 100% !important;
        }
        .hidden {
            display: none;
        }
        .no-results {
            display: none;
            color: red;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>

    <a href="{% url 'logout' %}"><button>Logout</button></a>
    <a href="{% url 'admin_chat' %}"><button>จัดการแชท</button></a>
    <a href="{% url 'admin_order_list' %}"><button>จัดการคำสั่งซื้อ</button></a>

    <h2>เพิ่มสินค้า</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">เพิ่มสินค้า</button>
    </form>

    <script>
        $(document).ready(function() {
            $('#id_category').select2({
                placeholder: 'Select categories',
                allowClear: true
            });
        });
    </script>

    <h2>จัดการสินค้า</h2>

    <!-- ✅ ช่องค้นหาสินค้า -->
    <input type="text" id="searchBox" placeholder="ค้นหาสินค้า..." style="width: 100%; padding: 10px; margin-bottom: 10px;">

    <!-- ✅ แจ้งเตือนเมื่อไม่พบสินค้า -->
    <p id="noResults" class="no-results">ไม่พบสินค้าที่ตรงกับคำค้นหา</p>

    <ul id="productList">
        {% for product in products %}
            <li class="product-item">
                <strong class="product-name">{{ product.name }}</strong> - ราคา: {{ product.price }} บาท
                <br>ขนาด: {{ product.size }}
                <br>หมวดหมู่:
                {% if product.category.all %}
                    {% for cat in product.category.all %}
                        {{ cat.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                {% else %}
                    (ไม่มีหมวดหมู่)
                {% endif %}
                <br>{{ product.description }}
                {% if product.image %}
                    <br><img src="{{ product.image.url }}" width="100">
                {% endif %}
                <br>
                <a href="{% url 'edit_product' product.id %}">แก้ไข</a> |
                <a href="{% url 'delete_product' product.id %}" onclick="return confirm('แน่ใจหรือไม่?');">ลบ</a>
            </li>
        {% endfor %}
    </ul>

    <script>
        $(document).ready(function() {
            $("#searchBox").on("keyup", function() {
                var searchText = $(this).val().toLowerCase().trim();
                var hasResults = false;

                $(".product-item").each(function() {
                    var itemName = $(this).find(".product-name").text().toLowerCase().trim();
                    if (itemName.includes(searchText)) {
                        $(this).show();
                        hasResults = true;
                    } else {
                        $(this).hide();
                    }
                });

                // ✅ แสดงข้อความ "ไม่พบสินค้า" ถ้าไม่มีผลลัพธ์
                if (hasResults) {
                    $("#noResults").hide();
                } else {
                    $("#noResults").show();
                }
            });
        });
    </script>
</body>
</html>
