<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard</title>
    
    <!-- jQuery (required by Select2) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
            integrity="sha256-/xUj+p6DV8E1AK7AN08z2mDl3/KnxZ6eGhHcyF5n8Mc="
            crossorigin="anonymous"></script>

    <!-- Select2 CSS and JS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <style>
        /* Optional: Adjust the width for Select2 to fit your layout */
        .select2-container {
            width: 100% !important;
        }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>

    <a href="{% url 'logout' %}"><button>Logout</button></a>

    <a href="{% url 'admin_chat' %}"><button>จัดการแชท</button></a>

    <a href="{% url 'admin_order_list' %}"><button>จัดการคำสั่งซื้อ</button></a>

    <h2>เพิ่มสินค้า</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- 
            If you render the entire form with as_p, the category field 
            will be included automatically. We'll attach Select2 via the ID.
        -->
        {{ form.as_p }}
        
        <button type="submit">เพิ่มสินค้า</button>
    </form>

    <!-- Initialize Select2 after the form is rendered -->
    <script>
        $(document).ready(function() {
            // By default, Django will give your category field an ID of "id_category"
            // (unless you manually changed it in the form).
            // Attach Select2 to that element:
            $('#id_category').select2({
                placeholder: 'Select categories',
                allowClear: true
            });
        });
    </script>

    <h2>จัดการสินค้า</h2>
    <ul>
        {% for product in products %}
            <li>
                <strong>{{ product.name }}</strong> - ราคา: {{ product.price }} บาท
                <br>ขนาด: {{ product.size }}
                <br>หมวดหมู่:
                {% if product.category.all %}
                    {% for cat in product.category.all %}
                        {{ cat.name }}{% if not forloop.last %}, {% endif %}
                    {% endfor %}
                {% else %}
                    (ไม่มีหมวดหมู่)
                {% endif %}
                <br>{{ product.description }}
                {% if product.image %}
                    <br><img src="{{ product.image.url }}" width="100">
                {% endif %}
                <br>
                <a href="{% url 'edit_product' product.id %}">แก้ไข</a> |
                <a href="{% url 'delete_product' product.id %}" onclick="return confirm('แน่ใจหรือไม่?');">ลบ</a>
            </li>
        {% endfor %}
    </ul>
</body>
</html>
