{% load static %}
{% load cart_extras %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>üì¶ Admin - Order List</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">

    <style>
        body {
            background-color: #f8f9fa;
        }
        .order-card {
            border-radius: 10px;
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease-in-out;
        }
        .order-card:hover {
            transform: translateY(-3px);
            box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.15);
        }
        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
        }
        .status-badge {
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 15px;
        }
        .progress {
            height: 8px;
            border-radius: 4px;
        }
        .tooltip-custom {
            font-size: 14px;
            font-weight: bold;
        }
    </style>
</head>
<body class="container mt-4">

    <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</h1>
        <a href="{% url 'admin_dashboard' %}" class="btn btn-dark">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
    </div>

    <!-- ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á -->
    <div class="table-responsive">
        <table class="table table-bordered table-striped table-hover text-center align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Order</th>
                    <th>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</th>
                    <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                    <th>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</th>
                    <th>‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>  
                    <th>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏°</th>  
                    <th>‡∏™‡∏•‡∏¥‡∏õ</th>
                    <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody>
                {% for order in orders %}
                <tr class="order-card">
                    <td><strong>#{{ order.id }}</strong></td>
                    <td><span class="text-primary fw-bold">{{ order.user.username }}</span></td>
                    <td>{{ order.created_at|date:"M d, Y, H:i A" }}</td>

                    <td>
                        {% if order.address_line %}
                            <span class="badge bg-secondary">{{ order.address_line }}</span><br>
                            <small class="text-muted">{{ order.zip_code }}</small>
                        {% else %}
                            <span class="badge bg-danger">‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏∞‡∏ö‡∏∏</span>
                        {% endif %}
                    </td>

                    <!-- ‚úÖ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ -->
                    <td>
                        <ul class="list-group list-group-flush">
                            {% for item in order.items.all %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ item.product.name }} 
                                    <span class="badge bg-primary">{{ item.quantity }} ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                </li>
                            {% endfor %}
                        </ul>
                    </td>

                    <!-- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ß‡∏° -->
                    <td><span class="fw-bold text-success">{{ order.total_price|floatformat:2 }} ‡∏ö‡∏≤‡∏ó</span></td>

                    <!-- ‚úÖ ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô -->
                    <td>
                        {% if order.payment_slip %}
                            <a href="{{ order.payment_slip.url }}" target="_blank" data-bs-toggle="tooltip" title="‡∏î‡∏π‡∏™‡∏•‡∏¥‡∏õ">
                                <img src="{{ order.payment_slip.url }}" class="img-fluid rounded" style="max-height: 60px;">
                            </a>
                        {% else %}
                            <span class="badge bg-danger">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏•‡∏¥‡∏õ</span>
                        {% endif %}
                    </td>

                    <!-- ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ -->
                    <td>
                        {% if order.status == "waiting_confirm" %}
                            <span class="badge bg-warning status-badge">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>
                            <div class="progress">
                                <div class="progress-bar bg-warning" style="width: 50%;"></div>
                            </div>
                        {% elif order.status == "approved" %}
                            <span class="badge bg-success status-badge">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡πÅ‡∏•‡πâ‡∏ß</span>
                            <div class="progress">
                                <div class="progress-bar bg-success" style="width: 100%;"></div>
                            </div>
                        {% elif order.status == "rejected" %}
                            <span class="badge bg-danger status-badge">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡πÅ‡∏•‡πâ‡∏ß</span>
                            <div class="progress">
                                <div class="progress-bar bg-danger" style="width: 100%;"></div>
                            </div>
                        {% endif %}
                    </td>

                    <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ -->
                    <td>
                        {% if order.status == "waiting_confirm" %}
                            <div class="d-flex flex-column gap-2">
                                <a href="{% url 'admin_confirm_payment' order.id %}" class="btn btn-sm btn-success">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</a>
                                <a href="{% url 'admin_reject_payment' order.id %}" class="btn btn-sm btn-danger">‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò</a>
                            </div>
                        {% endif %}        
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- ‚úÖ ‡∏õ‡∏∏‡πà‡∏° Back to Top -->
    <button onclick="scrollToTop()" id="backToTopBtn" title="‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô" class="btn btn-primary position-fixed bottom-0 end-0 m-3">
        ‚¨ÜÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
    </button>

    <!-- ‚úÖ JavaScript -->
    <script>
        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡∏°‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 300px
        window.onscroll = function() { scrollFunction(); };

        function scrollFunction() {
            var btn = document.getElementById("backToTopBtn");
            if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        }

        // ‚úÖ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô
        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        // ‚úÖ ‡πÄ‡∏õ‡∏¥‡∏î tooltip bootstrap
        var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
        var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
