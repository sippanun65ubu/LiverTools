{% load static %}
<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Vintage Shop</title>
    <style>
        /* Optional: style the price inputs side by side */
        .price-range {
            display: flex;
            gap: 10px;
        }
        .price-range input {
            width: 80px;
            text-align: center;
        }
        /* Scrollable container for categories */
        .category-scroll {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
        }
        /* Scrollable container for sizes */
        .size-scroll {
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 5px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>

    <!-- Check if user is logged in -->
    {% if user.is_authenticated %}
        <p>‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, {{ user.username }}!  
            <a href="{% url 'logout' %}"><button>‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button></a>
            <a href="{% url 'edit_profile' %}"><button>‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</button></a>
            <a href="{% url 'add_address' %}"><button>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</button></a>
            <a href="{% url 'payment_status' %}"><button>üìã ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠</button></a>
        </p>
        <a href="{% url 'user_chat' %}"><button>Chat ‡∏Å‡∏±‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button></a> <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏ä‡∏ó -->
    {% else %}
        <a href="{% url 'login' %}"><button>Login</button></a>
    {% endif %}


    <!-- Sidebar layout -->
    <div style="display: flex;">
        <!-- Sidebar -->
        <div style="width: 200px; margin-right: 20px;">
            <form method="GET" action="{% url 'product_list' %}">
                <!-- Search box -->
                <input type="text" name="q" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤..." value="{{ request.GET.q }}">
                <br><br>
                {% if user.is_authenticated %}
                <p>
                    <a href="{% url 'cart_detail' %}">
                        <!-- Could be an icon, but here just text. -->
                        ‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ({{ cart_items_count }})
                    </a>
                </p>
            {% else %}
                <!-- Possibly hide or show 0 if user is not authenticated -->
                <p>‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (0)</p>
            {% endif %}
                <!-- Price Range -->
                <h3>‡∏ä‡πà‡∏ß‡∏á‡∏£‡∏≤‡∏Ñ‡∏≤</h3>
                <div class="price-range">
                    <input type="text" name="min_price" placeholder="B ‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≥" value="{{ min_price }}">
                    <span>‚Äî</span>
                    <input type="text" name="max_price" placeholder="B ‡πÉ‡∏™‡πà‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏π‡∏á" value="{{ max_price }}">
                </div>
                <br>

                <!-- Category checkboxes in a scrollable container -->
                <h3>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>
                <div class="category-scroll">
                    {% for category in categories %}
                        <label>
                            <input type="checkbox" name="category" value="{{ category.id }}"
                                   {% if selected_categories and category.id|stringformat:"s" in selected_categories %}checked{% endif %}>
                            {{ category.name }}
                        </label><br>
                    {% endfor %}
                </div>
                
                <!-- Size checkboxes in a scrollable container -->
                <h3>‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏™‡∏∑‡πâ‡∏≠</h3>
                <div class="size-scroll">
                    {% for value, label in size_choices %}
                        <label>
                            <input type="checkbox" name="size" value="{{ value }}"
                                   {% if selected_sizes and value in selected_sizes %}checked{% endif %}>
                            {{ label }}
                        </label><br>
                    {% endfor %}
                </div>
                
                <br>
                <button type="submit">‡∏ï‡∏Å‡∏•‡∏á</button>
                <a href="{% url 'product_list' %}">‡∏•‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</a>
            </form>
        </div>

        <!-- Main content: product listing -->
        <div style="flex-grow: 1;">
            <ul>
                {% for product in products %}
                <li>
                    <strong>{{ product.name }}</strong> - ‡∏£‡∏≤‡∏Ñ‡∏≤: {{ product.price }} ‡∏ö‡∏≤‡∏ó
                    <br>‡∏Ç‡∏ô‡∏≤‡∏î: {{ product.size }}
                    <br>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: 
                    {% if product.category.all %}
                        {% for cat in product.category.all %}
                            {{ cat.name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    {% else %}
                        (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà)
                    {% endif %}
                    <br>{{ product.description }}
                    {% if product.image %}
                        <br><img src="{{ product.image.url }}" width="100">
                    {% endif %}
                    <br>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠: {{ product.quantity }}
                    <br>
                    {% if user.is_authenticated %}
                    <form method="post" action="{% url 'add_to_cart' product.id %}">
                        {% csrf_token %}
                        <input type="hidden" name="product_id" value="{{ product.id }}">
                        <input type="number" name="quantity" value="1" min="1">
                        <button type="submit">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏™‡πà‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤</button>              
                    </form>
                    {% else %}
                        <a href="{% url 'register' %}"><button>‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</button></a>
                    {% endif %}
                </li>
            {% empty %}
             <p>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>
        {% endfor %}
                